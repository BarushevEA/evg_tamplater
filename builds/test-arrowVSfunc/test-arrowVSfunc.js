(()=>{"use strict";var s,t;function e(s){return{isApplied:!0,state:s}}function r(s){return{isApplied:!1,state:s}}function i(s,t){return s>t?s:t}function n(s,t){return 0===s?t:0===t?s:s>t?t:s}function o(s,t){return Math.round((s+t)/2)}function u(s){return"next"in s?t=>s.next(t):s}!function(s){s.INIT="INIT",s.STARTED="STARTED",s.STOPPED="STOPPED",s.PROCESS="PROCESS",s.DESTROYED="DESTROYED",s.UNDEFINED="UNDEFINED",s.DELETED="DELETED",s.READY="READY"}(s||(s={})),function(s){s.NEGATIVE_DELAY="Delay must be a positive number.",s.TYPE_INVALID="TYPE_INVALID",s.NAME_IS_NOT_PRESENT="NAME_IS_NOT_PRESENT",s.INSTANCE_DESTROYED="INSTANCE_DESTROYED"}(t||(t={}));class h{constructor(s){this.pipe=s,this.counter=s.chain.length?s.chain.length:0}case(s){this.counter++;const t=this.counter,e=this.pipe.chain;return e.push((r=>{r.isAvailable=!0,s(r.payload)&&(r.isBreak=!0),t!==e.length||r.isBreak||(r.isAvailable=!1)})),this}pushCases(s){if(!Array.isArray(s))return this;for(let t=0;t<s.length;t++)this.case(s[t]);return this}}class a{constructor(){this.chain=[],this.flow={isBreak:!1,isUnsubscribe:!1,isAvailable:!1,payload:null}}refine(s){return this.push((t=>s(t.payload)&&(t.isAvailable=!0)))}setOnce(){return this.push((s=>{this.listener(s.payload),s.isUnsubscribe=!0}))}unsubscribeBy(s){return this.push((t=>{t.isAvailable=!0,s(t.payload)&&(t.isUnsubscribe=!0)}))}processChain(s){const t=this.chain,e=this.flow;for(let s=0;s<t.length;s++){if(e.isUnsubscribe=!1,e.isAvailable=!1,t[s](e),e.isUnsubscribe)return this.unsubscribe();if(!e.isAvailable)return;if(e.isBreak)break}return s(e.payload)}pushRefiners(s){if(!Array.isArray(s))return this;for(let t=0;t<s.length;t++)this.refine(s[t]);return this}switch(){return new c(this)}then(s){return this.push((t=>{t.payload=s(t.payload),t.isAvailable=!0}))}serialize(){return this.push((s=>{s.payload=JSON.stringify(s.payload),s.isAvailable=!0}))}deserialize(){return this.push((s=>{s.payload=JSON.parse(s.payload),s.isAvailable=!0}))}push(s){return this.chain.push(s),this}}class c extends h{subscribe(s,t){return this.pipe.subscribe(s,t)}}class l extends a{constructor(s,t){super(),this.paused=!1,this._order=0,this.piped=!1,this.errorHandler=(s,t)=>{console.log(`(Unit of SubscribeObject).send(${s}) ERROR:`,t)},this.observer=s,this.piped=!!t}get order(){return this._order}subscribe(s,t){return this.listener=function(s){if(Array.isArray(s)){const t=[];for(let e=0;e<s.length;e++)t.push(u(s[e]));return s=>{for(let e=0;e<t.length;e++)t[e](s)}}return u(s)}(s),t&&(this.errorHandler=t),this}send(s){try{this.flow.payload=s,this.flow.isBreak=!1,this.processValue(s)}catch(t){this.errorHandler(s,t)}}unsubscribe(){this.observer&&(this.observer.unSubscribe(this),this.observer=null,this.listener=null,this.chain.length=0)}resume(){this.paused=!1}pause(){this.paused=!0}set order(s){this._order=s}processValue(s){const t=this.listener;return t?this.observer&&!this.paused?this.piped?this.processChain(t):t(s):void 0:this.unsubscribe()}}class d{constructor(){this.chain=[],this.flow={isBreak:!1,isAvailable:!1,payload:null},this.response={isOK:!1,payload:void 0}}get isEmpty(){return!this.chain.length}filter(s){return this.push((t=>s(t.payload)&&(t.isAvailable=!0)))}pushFilters(s){if(!Array.isArray(s))return this;for(let t=0;t<s.length;t++)this.filter(s[t]);return this}push(s){return this.chain.push(s),this}switch(){return new p(this)}processChain(s){const t=this.chain,e=this.flow,r=this.response;r.isOK=!1,r.payload=void 0,e.payload=s,e.isBreak=!1;try{for(let s=0;s<t.length;s++){if(e.isAvailable=!1,t[s](e),!e.isAvailable)return r;if(e.isBreak)break}}catch(s){return this.errHandler?this.errHandler(s,"Filter.processChain ERROR:"):console.log("Filter.processChain ERROR:",s),r}return r.isOK=!0,r.payload=e.payload,r}addErrorHandler(s){this.errHandler=s}}class p extends h{}class f{constructor(s){this.value=s,this.subs=[],this.killed=!1,this.process=!1,this.stop=!0,this.trash=[],this.filters=new d}get isEnable(){return this.stop}get isDestroyed(){return this.killed}addFilter(s){return s&&this.filters.addErrorHandler(s),this.filters}disable(){this.stop=!1}enable(){this.stop=!0}next(s){if(!this.killed&&this.stop&&(this.filters.isEmpty||this.filters.processChain(s).isOK)){this.process=!0,this.value=s;for(let t=0;t<this.subs.length;t++)this.subs[t].send(s);this.process=!1,this.trash.length&&this.clearTrash()}}stream(s){if(!this.killed&&this.stop)for(let t=0;t<s.length;t++)this.next(s[t])}unSubscribe(s){this.killed||(this.process&&s?this.trash.push(s):this.subs&&function(s,t){const e=s.indexOf(t);-1!==e&&(s[e]=s[s.length-1],s.length=s.length-1)}(this.subs,s))}destroy(){this.value=null,this.unsubscribeAll(),this.subs=null,this.killed=!0}unsubscribeAll(){this.killed||(this.subs.length=0)}getValue(){if(!this.killed)return this.value}size(){return this.killed?0:this.subs.length}subscribe(s,t){if(!this.isListener(s))return;const e=new l(this,!1);return this.addObserver(e,s,t),e}pipe(){if(this.killed)return;const s=new l(this,!0);return this.subs.push(s),s}addObserver(s,t,e){s.subscribe(t,e),this.subs.push(s)}isListener(s){return!this.killed&&!!s}clearTrash(){const s=this.trash.length;for(let t=0;t<s;t++)this.unSubscribe(this.trash[t]);this.trash.length=0}}class D{constructor(){this.state$=new f(s.UNDEFINED)}get state(){return this.state$.isDestroyed?s.DESTROYED:this.state$.getValue()??s.UNDEFINED}start(){if(this.isDestroyed())return r(s.DESTROYED);const t=this.startProcess();return t.isApplied?e(t.state):t}stop(){if(this.isDestroyed())return r(s.DESTROYED);const t=this.stopProcess();return t.isApplied?e(t.state):t}destroy(){return this.stop(),this.state$.next(s.DESTROYED),this.state$.destroy(),e(s.DESTROYED)}subscribeOnState(s){if(!this.isDestroyed())return this.state$.subscribe(s)}subscribeOnProcess(t){if(!this.isDestroyed())return this.state$.pipe()?.refine((t=>t===s.PROCESS)).subscribe(t)}isDestroyed(){return this.state===s.DESTROYED}}class E extends D{constructor(){super(),this.id=0,this.delay=0}setInterval(i){return this.isDestroyed()?r(s.DESTROYED):this.id?r(s.STARTED):i<0?r(t.NEGATIVE_DELAY):(this.delay=i,this.state$.next(s.INIT),e(s.INIT))}startProcess(){return this.id=setInterval((()=>{this.state$.next(s.PROCESS)}),this.delay),this.state$.next(s.STARTED),e(s.STARTED)}stopProcess(){return clearInterval(this.id),this.id=0,this.state$.next(s.STOPPED),e(s.STOPPED)}}const O=s=>{const t=s._counter;s.countOfUsesPerMinute=t.minutes,s.countOfUsesPerMinuteMax=i(s.countOfUsesPerMinuteMax,t.minutes),s.countOfUsesPerMinuteMin=n(s.countOfUsesPerMinuteMin,t.minutes),s.countOfUsesPerMinuteAvg=o(s.countOfUsesPerMinuteAvg,t.minutes)},b=s=>{const t=s._counter;s.countOfUsesPerHour=t.hours,s.countOfUsesPerHourMax=i(s.countOfUsesPerHourMax,t.hours),s.countOfUsesPerHourMin=n(s.countOfUsesPerHourMin,t.hours),s.countOfUsesPerHourAvg=o(s.countOfUsesPerHourAvg,t.hours)},y=s=>{const t=s._counter;s.countOfUsesPerDay=t.days,s.countOfUsesPerDayMax=i(s.countOfUsesPerDayMax,t.days),s.countOfUsesPerDayMin=n(s.countOfUsesPerDayMin,t.days),s.countOfUsesPerDayAvg=o(s.countOfUsesPerDayAvg,t.days)};class T{constructor(){this.metrics={},this._state=s.STOPPED,this.perSecond=new E,this.perSecond.setInterval(1e3),this.perMinute=new E,this.perMinute.setInterval(6e4),this.perHour=new E,this.perHour.setInterval(36e5),this.perDay=new E,this.perDay.setInterval(864e5)}get length(){return Object.keys(this.metrics).length}get state(){return this._state}start(){return this.isDestroyed()?r(t.INSTANCE_DESTROYED):this._state===s.STARTED?r(s.STARTED):(this.perSecond.start(),this.perMinute.start(),this.perHour.start(),this.perDay.start(),this._state=s.STARTED,e(s.STARTED))}stop(){if(this.isDestroyed())return r(t.INSTANCE_DESTROYED);this.perSecond.stop(),this.perMinute.stop(),this.perHour.stop(),this.perDay.stop();for(const s in this.metrics){const t=this.metrics[s];t._counter.days=0,t._counter.hours=0,t._counter.minutes=0,t._counter.seconds=0}return this._state=s.STOPPED,e(s.STOPPED)}destroy(){return this.isDestroyed()?r(t.INSTANCE_DESTROYED):(this.stop(),this.clearFunc(),this.perSecond.destroy(),this.perMinute.destroy(),this.perHour.destroy(),this.perDay.destroy(),this._state=s.DESTROYED,e(s.DESTROYED))}isDestroyed(){return this._state===s.DESTROYED}decorate(t,e){const{deleteObj:r,metric:i}=this.createMetric(t);return(...t)=>{if(r.isDeleted)return e(...t);const n=Date.now();this.trackMetric(i);try{return e(...t)}catch(t){throw r.isDeleted||this._state!==s.STARTED||i.countOfErrors++,t}finally{r.isDeleted||this._state!==s.STARTED||(i.timePerCall=Date.now()-n,i.totalExecutionTime+=i.timePerCall)}}}decorateAsync(t,e){const{deleteObj:r,metric:i}=this.createMetric(t);return async(...t)=>{if(r.isDeleted)return await e(...t);const n=Date.now();this.trackMetric(i);try{return await e(...t)}catch(t){throw r.isDeleted||this._state!==s.STARTED||i.countOfErrors++,t}finally{r.isDeleted||this._state!==s.STARTED||(i.timePerCall=Date.now()-n,i.totalExecutionTime+=i.timePerCall)}}}deleteFunc(i){if(this.isDestroyed())return r(t.INSTANCE_DESTROYED);if(i in this.metrics){const t=this.metrics[i];return t._deleteObj.isDeleted=!0,t._deleteObj=null,delete this.metrics[i],e(s.DELETED)}return r(t.NAME_IS_NOT_PRESENT)}createMetric(s){if(s in this.metrics)throw new Error(`A function with the name "${s}" is already decorated`);if(this.isDestroyed())throw new Error(t.INSTANCE_DESTROYED);const e={isDeleted:!1};this.metrics[s]={countOfUses:0,countOfErrors:0,totalExecutionTime:0,timePerCall:0,countOfUsesPerSecond:0,countOfUsesPerMinute:0,countOfUsesPerHour:0,countOfUsesPerDay:0,countOfUsesPerDayAvg:0,countOfUsesPerDayMax:0,countOfUsesPerDayMin:0,countOfUsesPerHourAvg:0,countOfUsesPerHourMax:0,countOfUsesPerHourMin:0,countOfUsesPerMinuteAvg:0,countOfUsesPerMinuteMax:0,countOfUsesPerMinuteMin:0,countOfUsesPerSecondAvg:0,countOfUsesPerSecondMax:0,countOfUsesPerSecondMin:0,_deleteObj:e,_counter:{seconds:0,minutes:0,hours:0,days:0}};const r=this.metrics[s];return this.addTimers(e,r),{deleteObj:e,metric:r}}clearFunc(){const s=[];for(const t in this.metrics)s.push(t);for(const t of s)this.deleteFunc(t)}trackMetric(t){this._state===s.STARTED&&(t.countOfUses++,t._counter.seconds++,t._counter.minutes++,t._counter.hours++,t._counter.days++)}getMetrics(s){const t={...this.metrics[s]};return delete t._deleteObj,delete t._counter,t}getAll(){const s={};for(const t in this.metrics)s[t]=this.getMetrics(t);return s}addTimers(s,t){const e=t._counter;this.addTimer(s,this.perSecond,(()=>{(s=>{const t=s._counter;s.countOfUsesPerSecond=t.seconds,s.countOfUsesPerSecondMax=i(s.countOfUsesPerSecondMax,t.seconds),s.countOfUsesPerSecondMin=n(s.countOfUsesPerSecondMin,t.seconds),s.countOfUsesPerSecondAvg=o(s.countOfUsesPerSecondAvg,t.seconds)})(t),O(t),b(t),y(t),e.seconds=0})),this.addTimer(s,this.perMinute,(()=>{O(t),b(t),y(t),e.minutes=0})),this.addTimer(s,this.perHour,(()=>{b(t),y(t),e.hours=0})),this.addTimer(s,this.perDay,(()=>{y(t),e.days=0}))}addTimer(s,t,e){const r=t.subscribeOnProcess((()=>{s.isDeleted?r?.unsubscribe():e()}))}}new T;const S=new T;function P(s){return 10+s}const A=s=>10+s,U=1e10;let _=S.decorate("fnc",(function(){for(let s=0;s<U;s++)P(s)})),g=S.decorate("arw",(function(){for(let s=0;s<U;s++)A(s)}));S.start(),_(),g(),S.stop(),console.log(S.getAll())})();